{"ast":null,"code":"import { __awaiter as e } from \"../../../../node_modules/.pnpm/@rollup_plugin-typescript@11.1.6_rollup@4.24.4_tslib@2.6.3_typescript@4.9.5/node_modules/tslib/tslib.es6.js\";\nimport { sendMessageToParent as r } from \"../internal/communication.js\";\nimport { registerHandler as i } from \"../internal/handlers.js\";\nimport { ensureInitialized as o } from \"../internal/internalAPIs.js\";\nimport { getApiVersionTag as t } from \"../internal/telemetry.js\";\nimport { inServerSideRenderingEnvironment as n } from \"../internal/utils.js\";\nimport { createEffectParameterChangeCallback as d, processMediaStreamWithMetadata as s, processMediaStream as a } from \"../internal/videoEffectsUtils.js\";\nimport { VideoPerformanceMonitor as f } from \"../internal/videoPerformanceMonitor.js\";\nimport { errorNotSupportedOnPlatform as m, FrameContexts as c } from \"../public/constants.js\";\nimport { runtime as l } from \"../public/runtime.js\";\nimport { isSupported as v } from \"../public/videoEffects.js\";\nconst u = \"v2\",\n  p = 2e3,\n  E = n() ? void 0 : new f(r);\nvar F;\nfunction g(n) {\n  var d, f;\n  if (!x()) throw m;\n  if (!n.videoFrameHandler || !n.videoBufferHandler) throw new Error(\"Both videoFrameHandler and videoBufferHandler must be provided\");\n  if (o(l, c.sidePanel)) {\n    if (i(t(u, \"videoEffectsEX.registerSetFrameProcessTimeLimitHandler\"), \"video.setFrameProcessTimeLimit\", e => null == E ? void 0 : E.setFrameProcessTimeLimit(e), !1), null === (d = l.supports.video) || void 0 === d ? void 0 : d.mediaStream) i(t(u, \"videoEffectsEX.registerStartVideoExtensibilityVideoStreamHandler\"), \"video.startVideoExtensibilityVideoStream\", r => e(this, void 0, void 0, function* () {\n      const {\n          streamId: i,\n          metadataInTexture: o\n        } = r,\n        t = E ? function (r, i) {\n          return o => e(this, void 0, void 0, function* () {\n            const e = o.videoFrame;\n            i.reportStartFrameProcessing(e.codedWidth, e.codedHeight);\n            const t = h(),\n              n = yield r(o);\n            return t(), i.reportFrameProcessed(), n;\n          });\n        }(n.videoFrameHandler, E) : n.videoFrameHandler;\n      o ? yield s(i, t, y, E) : yield a(i, t, y, E);\n    }), !1), r(t(u, \"videoEffectsEX.mediaStream.registerForVideoFrame\"), \"video.mediaStream.registerForVideoFrame\", [n.config]);else {\n      if (!(null === (f = l.supports.video) || void 0 === f ? void 0 : f.sharedFrame)) throw m;\n      i(t(u, \"videoEffectsEx.registerNewVideoFrameHandler\"), \"video.newVideoFrame\", e => {\n        if (e) {\n          null == E || E.reportStartFrameProcessing(e.width, e.height);\n          const i = h(),\n            o = e.timestamp;\n          n.videoBufferHandler(function (e) {\n            return e.videoFrameBuffer = e.videoFrameBuffer || e.data, delete e.data, e;\n          }(e), () => {\n            i(), null == E || E.reportFrameProcessed(), function (e) {\n              r(t(u, \"videoEffectsEx.notifyVideoFrameProcessed\"), \"video.videoFrameProcessed\", [e]);\n            }(o);\n          }, y);\n        }\n      }, !1), r(t(u, \"videoEffectsEx.registerForVideoFrame\"), \"video.registerForVideoFrame\", [n.config]);\n    }\n    null == E || E.startMonitorSlowFrameProcessing();\n  }\n}\nfunction h() {\n  const e = setTimeout(() => {\n    y(\"Frame not processed in \".concat(p, \"ms\"), F.Warn);\n  }, p);\n  return function () {\n    clearTimeout(e);\n  };\n}\nfunction P(e, i, n) {\n  if (o(l, c.sidePanel), !x()) throw m;\n  r(t(u, \"videoEffectsEx.notifySelectedVideoEffectChanged\"), \"video.videoEffectChanged\", [e, i, n]);\n}\nfunction w(e) {\n  if (o(l, c.sidePanel), !x()) throw m;\n  i(t(u, \"videoEffectsEx.registerEffectParamterChangeHandler\"), \"video.effectParameterChange\", d(e, E), !1), r(t(u, \"videoEffectsEx.registerForVideoEffect\"), \"video.registerForVideoEffect\");\n}\nfunction V(e) {\n  if (o(l, c.sidePanel), !v()) throw m;\n  r(t(u, \"videoEffectsEx.updatePersonalizedEffects\"), \"video.personalizedEffectsChanged\", [e]);\n}\nfunction x() {\n  return o(l), v();\n}\nfunction y(e) {\n  let i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : F.Warn;\n  r(t(u, \"videoEffectsEx.notifyError\"), \"video.notifyError\", [e, i]);\n}\nfunction H(e) {\n  if (o(l), !v()) throw m;\n  y(e, F.Fatal);\n}\n!function (e) {\n  e.Fatal = \"fatal\", e.Warn = \"warn\";\n}(F || (F = {}));\nexport { F as ErrorLevel, p as frameProcessingTimeoutInMs, x as isSupported, H as notifyFatalError, P as notifySelectedVideoEffectChanged, w as registerForVideoEffect, g as registerForVideoFrame, V as updatePersonalizedEffects };","map":{"version":3,"names":["__awaiter","e","sendMessageToParent","r","registerHandler","i","ensureInitialized","o","getApiVersionTag","t","inServerSideRenderingEnvironment","n","createEffectParameterChangeCallback","d","processMediaStreamWithMetadata","s","processMediaStream","a","VideoPerformanceMonitor","f","errorNotSupportedOnPlatform","m","FrameContexts","c","runtime","l","isSupported","v","u","p","E","F","g","x","videoFrameHandler","videoBufferHandler","Error","sidePanel","setFrameProcessTimeLimit","supports","video","mediaStream","streamId","metadataInTexture","videoFrame","reportStartFrameProcessing","codedWidth","codedHeight","h","reportFrameProcessed","y","config","sharedFrame","width","height","timestamp","videoFrameBuffer","data","startMonitorSlowFrameProcessing","setTimeout","concat","Warn","clearTimeout","P","w","V","arguments","length","undefined","H","Fatal","ErrorLevel","frameProcessingTimeoutInMs","notifyFatalError","notifySelectedVideoEffectChanged","registerForVideoEffect","registerForVideoFrame","updatePersonalizedEffects"],"sources":["D:/KattSafe/pdf-qa-frontend/node_modules/@microsoft/teams-js/dist/esm/packages/teams-js/src/private/videoEffectsEx.js"],"sourcesContent":["import{__awaiter as e}from\"../../../../node_modules/.pnpm/@rollup_plugin-typescript@11.1.6_rollup@4.24.4_tslib@2.6.3_typescript@4.9.5/node_modules/tslib/tslib.es6.js\";import{sendMessageToParent as r}from\"../internal/communication.js\";import{registerHandler as i}from\"../internal/handlers.js\";import{ensureInitialized as o}from\"../internal/internalAPIs.js\";import{getApiVersionTag as t}from\"../internal/telemetry.js\";import{inServerSideRenderingEnvironment as n}from\"../internal/utils.js\";import{createEffectParameterChangeCallback as d,processMediaStreamWithMetadata as s,processMediaStream as a}from\"../internal/videoEffectsUtils.js\";import{VideoPerformanceMonitor as f}from\"../internal/videoPerformanceMonitor.js\";import{errorNotSupportedOnPlatform as m,FrameContexts as c}from\"../public/constants.js\";import{runtime as l}from\"../public/runtime.js\";import{isSupported as v}from\"../public/videoEffects.js\";const u=\"v2\",p=2e3,E=n()?void 0:new f(r);var F;function g(n){var d,f;if(!x())throw m;if(!n.videoFrameHandler||!n.videoBufferHandler)throw new Error(\"Both videoFrameHandler and videoBufferHandler must be provided\");if(o(l,c.sidePanel)){if(i(t(u,\"videoEffectsEX.registerSetFrameProcessTimeLimitHandler\"),\"video.setFrameProcessTimeLimit\",(e=>null==E?void 0:E.setFrameProcessTimeLimit(e)),!1),null===(d=l.supports.video)||void 0===d?void 0:d.mediaStream)i(t(u,\"videoEffectsEX.registerStartVideoExtensibilityVideoStreamHandler\"),\"video.startVideoExtensibilityVideoStream\",(r=>e(this,void 0,void 0,(function*(){const{streamId:i,metadataInTexture:o}=r,t=E?function(r,i){return o=>e(this,void 0,void 0,(function*(){const e=o.videoFrame;i.reportStartFrameProcessing(e.codedWidth,e.codedHeight);const t=h(),n=yield r(o);return t(),i.reportFrameProcessed(),n}))}(n.videoFrameHandler,E):n.videoFrameHandler;o?yield s(i,t,y,E):yield a(i,t,y,E)}))),!1),r(t(u,\"videoEffectsEX.mediaStream.registerForVideoFrame\"),\"video.mediaStream.registerForVideoFrame\",[n.config]);else{if(!(null===(f=l.supports.video)||void 0===f?void 0:f.sharedFrame))throw m;i(t(u,\"videoEffectsEx.registerNewVideoFrameHandler\"),\"video.newVideoFrame\",(e=>{if(e){null==E||E.reportStartFrameProcessing(e.width,e.height);const i=h(),o=e.timestamp;n.videoBufferHandler(function(e){return e.videoFrameBuffer=e.videoFrameBuffer||e.data,delete e.data,e}(e),(()=>{i(),null==E||E.reportFrameProcessed(),function(e){r(t(u,\"videoEffectsEx.notifyVideoFrameProcessed\"),\"video.videoFrameProcessed\",[e])}(o)}),y)}}),!1),r(t(u,\"videoEffectsEx.registerForVideoFrame\"),\"video.registerForVideoFrame\",[n.config])}null==E||E.startMonitorSlowFrameProcessing()}}function h(){const e=setTimeout((()=>{y(`Frame not processed in ${p}ms`,F.Warn)}),p);return function(){clearTimeout(e)}}function P(e,i,n){if(o(l,c.sidePanel),!x())throw m;r(t(u,\"videoEffectsEx.notifySelectedVideoEffectChanged\"),\"video.videoEffectChanged\",[e,i,n])}function w(e){if(o(l,c.sidePanel),!x())throw m;i(t(u,\"videoEffectsEx.registerEffectParamterChangeHandler\"),\"video.effectParameterChange\",d(e,E),!1),r(t(u,\"videoEffectsEx.registerForVideoEffect\"),\"video.registerForVideoEffect\")}function V(e){if(o(l,c.sidePanel),!v())throw m;r(t(u,\"videoEffectsEx.updatePersonalizedEffects\"),\"video.personalizedEffectsChanged\",[e])}function x(){return o(l),v()}function y(e,i=F.Warn){r(t(u,\"videoEffectsEx.notifyError\"),\"video.notifyError\",[e,i])}function H(e){if(o(l),!v())throw m;y(e,F.Fatal)}!function(e){e.Fatal=\"fatal\",e.Warn=\"warn\"}(F||(F={}));export{F as ErrorLevel,p as frameProcessingTimeoutInMs,x as isSupported,H as notifyFatalError,P as notifySelectedVideoEffectChanged,w as registerForVideoEffect,g as registerForVideoFrame,V as updatePersonalizedEffects};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}